<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Recipe Book (JSON Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .modal {
            display: none;
        }

        .modal.active {
            display: flex;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        textarea {
            resize: vertical;
        }

        .recipe-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Basic styling for prose in instructions */
        .prose {
            line-height: 1.6;
        }

        .prose p {
            margin-bottom: 1em;
        }

        .prose ul,
        .prose ol {
            margin-left: 1.5em;
            margin-bottom: 1em;
        }

        .prose li {
            margin-bottom: 0.5em;
        }
    </style>
</head>

<body class="antialiased text-slate-800">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-indigo-600">ARMA Recipe book</h1>
            <p class="text-slate-600 mt-2">Powered by good intentions</p>
        </header>

        <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <p class="text-sm text-slate-500">Recipes are loaded from <code>recipes.json</code>. To add or edit, update
                the JSON file (e.g., using the Python scraper).</p>
            <div class="relative w-full sm:w-1/2">
                <input type="text" id="searchInput" placeholder="Search by name, ingredients..."
                    class="w-full py-3 px-4 pl-10 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                <svg class="w-5 h-5 text-slate-400 absolute left-3 top-1/2 transform -translate-y-1/2"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
        </div>

        <div id="recipeList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        </div>
        <p id="statusMessage" class="text-center text-slate-500 mt-10 text-lg">Loading recipes...</p>
    </div>

    <div id="viewRecipeModal"
        class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center p-4 z-50">
        <div
            class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="flex justify-between items-start mb-4">
                <h2 id="viewRecipeName" class="text-3xl font-bold text-indigo-600">Recipe Name</h2>
                <button id="closeViewModalBtn" class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button>
            </div>

            <img id="viewImage" src="" alt="Recipe Image" class="w-full h-64 object-cover rounded-lg mb-6 hidden"
                onerror="this.style.display='none'; this.onerror=null;">

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-slate-700 mb-1">Source</h3>
                <a id="viewRecipeURL" href="#" target="_blank" class="text-indigo-500 hover:underline break-all"></a>
                <p id="noRecipeURL" class="text-slate-500 italic hidden">No URL provided.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 text-sm">
                <div>
                    <p class="font-semibold text-slate-700">Prep Time:</p>
                    <p id="viewPrepTime" class="text-slate-600"></p>
                </div>
                <div>
                    <p class="font-semibold text-slate-700">Cook Time:</p>
                    <p id="viewCookTime" class="text-slate-600"></p>
                </div>
                <div>
                    <p class="font-semibold text-slate-700">Servings:</p>
                    <p id="viewServings" class="text-slate-600"></p>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-slate-700 mb-2">Ingredients</h3>
                <ul id="viewIngredients" class="list-disc list-inside text-slate-600 space-y-1"></ul>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-slate-700 mb-2">Instructions</h3>
                <div id="viewInstructions" class="text-slate-600 whitespace-pre-wrap prose"></div>
            </div>

            <div id="viewNotesSection" class="mb-6 hidden">
                <h3 class="text-xl font-semibold text-slate-700 mb-2">Notes</h3>
                <p id="viewNotes" class="text-slate-600 italic whitespace-pre-wrap"></p>
            </div>

            <div class="flex justify-end mt-8">
                <button id="closeViewModalBtnBottom"
                    class="py-2 px-5 text-slate-700 border border-slate-300 rounded-lg hover:bg-slate-100 transition duration-150">Close</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const recipeList = document.getElementById('recipeList');
        const searchInput = document.getElementById('searchInput');
        const statusMessage = document.getElementById('statusMessage');

        // View Modal Elements
        const viewRecipeModal = document.getElementById('viewRecipeModal');
        const closeViewModalBtn = document.getElementById('closeViewModalBtn');
        const closeViewModalBtnBottom = document.getElementById('closeViewModalBtnBottom');
        const viewRecipeName = document.getElementById('viewRecipeName');
        const viewRecipeURL = document.getElementById('viewRecipeURL');
        const noRecipeURL = document.getElementById('noRecipeURL');
        const viewPrepTime = document.getElementById('viewPrepTime');
        const viewCookTime = document.getElementById('viewCookTime');
        const viewServings = document.getElementById('viewServings');
        const viewIngredients = document.getElementById('viewIngredients');
        const viewInstructions = document.getElementById('viewInstructions');
        const viewImage = document.getElementById('viewImage');
        const viewNotesSection = document.getElementById('viewNotesSection');
        const viewNotes = document.getElementById('viewNotes');

        // Application State
        let allRecipes = []; // To store all recipes loaded from JSON

        // --- Event Listeners ---
        searchInput.addEventListener('input', () => displayRecipes(allRecipes));
        closeViewModalBtn.addEventListener('click', () => viewRecipeModal.classList.remove('active'));
        closeViewModalBtnBottom.addEventListener('click', () => viewRecipeModal.classList.remove('active'));
        document.addEventListener('DOMContentLoaded', loadRecipesAndDisplay);

        // --- Core Functions ---

        /**
         * Fetches recipes from recipes.json and then displays them.
         */
        async function loadRecipesAndDisplay() {
            try {
                // In a real deployment, recipes.json should be in the same directory or a known relative path.
                // For local testing, ensure recipes.json is next to your HTML file.
                const response = await fetch('recipes.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} - Could not load recipes.json. Make sure the file exists and is accessible.`);
                }
                allRecipes = await response.json();
                if (!Array.isArray(allRecipes)) {
                    throw new Error('recipes.json is not a valid JSON array.');
                }
                statusMessage.textContent = ''; // Clear loading message
                displayRecipes(allRecipes);
            } catch (error) {
                console.error("Error loading recipes:", error);
                statusMessage.textContent = `Error: ${error.message}`;
                statusMessage.classList.add('text-red-500');
                allRecipes = []; // Ensure it's an empty array on error
                displayRecipes(allRecipes); // Display empty state
            }
        }

        /**
         * Displays recipes on the page, filtered by search term.
         * @param {Array} recipesToDisplay - The array of recipe objects to display.
         */
        function displayRecipes(recipesToDisplay) {
            recipeList.innerHTML = ''; // Clear current list
            const searchTerm = searchInput.value.toLowerCase().trim();

            const filteredRecipes = recipesToDisplay.filter(recipe => {
                if (!recipe || typeof recipe.name !== 'string' || !Array.isArray(recipe.ingredients)) {
                    console.warn('Skipping invalid recipe object:', recipe);
                    return false; // Skip malformed recipe objects
                }
                const nameMatch = recipe.name.toLowerCase().includes(searchTerm);
                const ingredientsMatch = recipe.ingredients.some(ing => typeof ing === 'string' && ing.toLowerCase().includes(searchTerm));
                return nameMatch || ingredientsMatch;
            });

            if (filteredRecipes.length === 0) {
                statusMessage.classList.remove('hidden');
                if (allRecipes.length > 0 && searchTerm) {
                    statusMessage.textContent = `No recipes found for "${searchTerm}".`;
                } else if (allRecipes.length === 0 && statusMessage.textContent === '') { // Only show if not already showing an error
                    statusMessage.textContent = 'No recipes found in recipes.json or the file is empty.';
                } else if (statusMessage.textContent === '') { // Default if allRecipes loaded but empty
                    statusMessage.textContent = 'No recipes available.';
                }
            } else {
                statusMessage.classList.add('hidden'); // Hide if recipes are shown
                statusMessage.textContent = ''; // Clear any previous messages
            }

            filteredRecipes.forEach(recipe => {
                const card = createRecipeCard(recipe);
                recipeList.appendChild(card);
            });
        }

        /**
         * Creates an HTML card element for a single recipe.
         * @param {object} recipe - The recipe object.
         * @returns {HTMLElement} The recipe card element.
         */
        function createRecipeCard(recipe) {
            const card = document.createElement('div');
            card.className = 'recipe-card bg-white p-5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col justify-between';

            const shortIngredients = Array.isArray(recipe.ingredients) ?
                (recipe.ingredients.slice(0, 3).join(', ') + (recipe.ingredients.length > 3 ? '...' : '')) :
                'Not specified';

            card.innerHTML = `
                <div>
                    ${recipe.imageUrl ? `<img src="${recipe.imageUrl}" alt="${recipe.name}" class="w-full h-40 object-cover rounded-lg mb-4" onerror="this.src='https://placehold.co/600x400/e2e8f0/94a3b8?text=No+Image'; this.onerror=null;">` : `<div class="w-full h-40 bg-slate-200 rounded-lg mb-4 flex items-center justify-center text-slate-500"><p>No Image</p></div>`}
                    <h3 class="text-xl font-semibold text-indigo-600 mb-2 truncate" title="${recipe.name || ''}">${recipe.name || 'Untitled Recipe'}</h3>
                    ${recipe.url ? `<a href="${recipe.url}" target="_blank" class="text-sm text-indigo-500 hover:underline break-all block mb-2 truncate" title="${recipe.url}">${recipe.url}</a>` : ''}
                    <p class="text-sm text-slate-600 mb-1"><strong class="font-medium">Ingredients:</strong> ${shortIngredients}</p>
                    <p class="text-sm text-slate-600 mb-3"><strong class="font-medium">Prep:</strong> ${recipe.prepTime || 'N/A'} | <strong class="font-medium">Cook:</strong> ${recipe.cookTime || 'N/A'}</p>
                </div>
                <div class="mt-4 flex justify-end">
                    <button class="view-btn text-sm bg-sky-500 hover:bg-sky-600 text-white py-2 px-4 rounded-md transition duration-150 w-full sm:w-auto" data-id="${recipe.id}">View Details</button>
                </div>
            `;
            // Note: Edit and Delete buttons are removed as data is managed via recipes.json

            card.querySelector('.view-btn').addEventListener('click', () => openViewModal(recipe.id));
            return card;
        }

        /**
         * Opens the modal to view recipe details.
         * @param {string} recipeId - The ID of the recipe to view.
         */
        function openViewModal(recipeId) {
            const recipe = allRecipes.find(r => r.id === recipeId);
            if (!recipe) return;

            viewRecipeName.textContent = recipe.name || 'Recipe Details';

            if (recipe.url) {
                viewRecipeURL.href = recipe.url;
                viewRecipeURL.textContent = recipe.url;
                viewRecipeURL.classList.remove('hidden');
                noRecipeURL.classList.add('hidden');
            } else {
                viewRecipeURL.classList.add('hidden');
                noRecipeURL.classList.remove('hidden');
            }

            viewPrepTime.textContent = recipe.prepTime || 'N/A';
            viewCookTime.textContent = recipe.cookTime || 'N/A';
            viewServings.textContent = recipe.servings || 'N/A';

            viewIngredients.innerHTML = ''; // Clear previous ingredients
            if (Array.isArray(recipe.ingredients) && recipe.ingredients.length > 0) {
                recipe.ingredients.forEach(ing => {
                    const li = document.createElement('li');
                    li.textContent = ing;
                    viewIngredients.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'No ingredients listed.';
                li.className = 'italic text-slate-500';
                viewIngredients.appendChild(li);
            }

            // Sanitize and display instructions (simple text display)
            viewInstructions.textContent = recipe.instructions || 'No instructions provided.';

            if (recipe.imageUrl) {
                viewImage.src = recipe.imageUrl;
                viewImage.alt = recipe.name;
                viewImage.classList.remove('hidden');
            } else {
                viewImage.classList.add('hidden');
                viewImage.src = '';
            }

            if (recipe.notes) {
                viewNotes.textContent = recipe.notes;
                viewNotesSection.classList.remove('hidden');
            } else {
                viewNotesSection.classList.add('hidden');
            }

            viewRecipeModal.classList.add('active');
        }

    </script>
</body>

</html>